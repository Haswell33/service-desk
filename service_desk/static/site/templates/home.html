{% extends 'base.html' %}

<head>
  {% load filters %}
  <title>{% block title %} {{ block.super }}{% endblock %}</title>
  <meta http-equiv="refresh" content="60">
</head>

<body>
  {% block content %}
  {% block sidebar %}
  <div id="sidebar" class="sticky">
    <div id="sidebar-block_toggle" class="sticky arrow-left"></div>
    <div id="sidebar-block_content" class="sticky">
      <div id="sidebar-block_tenant" class="sidebar-block">
        <select id="sidebar-block_tenant-set">
        {% for tenant_session in tenant_sessions %}
          {% if tenant_session.active %}
            <option icon="{{ tenant_session.tenant.icon }}" value="{{ tenant_session.tenant.id }}" selected>{{ tenant_session.tenant.name }}</option>
          {% else %}
            <option icon="{{ tenant_session.tenant.icon }}" value="{{ tenant_session.tenant.id }}">{{ tenant_session.tenant.name }}</option>
          {% endif %}
        {% endfor %}
        </select>
      </div>
      <div class="sidebar-block">
        <div id="sidebar-block_menu">
          <ul>
            <li id="menu-block_create-ticket">
              <a href="{% url 'create_ticket' %}">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 16 16">
                  <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                </svg>
                <p>Create ticket</p>
              </a>
            </li>
            <li id="menu-block_filter-view">
              <a href="{% url 'filter_ticket' %}">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 16 16">
                  <path d="M6 10.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"/>
                </svg>
                <p>Filter view</p>
              </a>
            </li>
          </ul>
        </div>
        <div id="sidebar-block_recent-actions">

        </div>
      </div>
    </div>
  </div>
  {% endblock %}
  <div id="content-page">
    {% block content_page %}
    <div id="content-page_header">
      <div class="content-page_header-block">
        <h2>Board</h2>
      </div>
      <div class="content-page_header-block">
        <div class="content-page_header-block filter">
          <form method="GET" action="{% url 'home' %}">
            <select id="board_filter_assignee" class="filter-field" name="assignee">
              <option></option>
              {% for user in users %}
                <option icon="{{ user.icon }}" value="{{ user.username }}">{{ user.username }}</option>
              {% endfor %}
            </select>
            <select id="board_filter_reporter" class="filter-field" name="reporter">
              <option></option>
              {% for user in users %}
                <option icon="{{ user.icon }}" value="{{ user.username }}">{{ user.username }}</option>
              {% endfor %}
            </select>
            <input type="submit" value="Filter"/>
          </form>
        </div>
        <div class="content-page_header-block tooltip">
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
            <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.496 6.033h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286a.237.237 0 0 0 .241.247zm2.325 6.443c.61 0 1.029-.394 1.029-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94 0 .533.425.927 1.01.927z"/>
          </svg>
          <div class="tooltip-text">
            <div style="background: var(--theme-hover); width: 20px; height: 20px; border-radius: 4px;">
              text1
            </div>
            <div style="background: #c9c9c9; width: 20px; height: 20px; border-radius: 4px;">
              text2
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="content-page_content" class="content-page-block">
      <div id="board">
        {% for board_column_association in board_columns_associations %}
          <div class="board-column" number="{{ board_column_association.0.column.column_number }}">
            <h2>{{ board_column_association.0.column }}</h2>
            {% for association in board_column_association %}
              {% for ticket in tickets %}
                {% if ticket.status == association.status %}
                  {% if ticket.suspended %}
                    <div class="ticket-block suspended" key="{{ ticket.key }}">
                  {% else %}
                    {% if ticket.assignee == request.user %}
                      <div class="ticket-block assigned" key="{{ ticket.key }}">
                    {% else %}
                      <div class="ticket-block" key="{{ ticket.key }}">
                    {% endif %}
                  {% endif %}
                  <div class="ticket-block_row" row="1">
                    <a href="{% url 'view_ticket' ticket.slug %}">
                      <div class="ticket_link">
                        {{ ticket.type.icon_img }}
                        <p class="ticket-key">{{ ticket.key }}</p>
                      </div>
                    </a>
                    <div class="ticket-block_row-block">
                      {{ ticket.status.status_color }}
                    </div>
                  </div>
                  <div class="ticket-block_row" row="2">
                    <div class="ticket-block_row-block">
                      {{ ticket.priority.icon_img }}
                    </div>
                    <div class="ticket-block_row-block">
                      <p class="ticket-title">{{ ticket.title }}</p>
                    </div>
                  </div>
                  <div class="ticket-block_row" row="3">
                    <div class="ticket-block_row-block">
                      {{ ticket.reporter_img }}
                    </div>
                    <div class="ticket-block_row-block">
                      {% if ticket.assignee_img %}
                        {{ ticket.assignee_img }}
                      {% else %}
                        <p class="ticket-block_info">No assignee</p>
                      {% endif %}
                    </div>
                  </div>
                </div>
              {% endif %}
            {% endfor %}
          {% endfor %}
          </div>
          <div class="separator"></div>
        {% endfor %}
      </div>
    </div>
    {% endblock %}
  </div>
  <script>
    $(document).ready(function(){
      renderFields('home', '{{ MEDIA_URL }}')
      $('#board > .board-column').each(function(){
        let ticketNumInColumn = ($(this).find('.ticket-block').length)
        if (ticketNumInColumn === 0)
          $(this).append('<p class="ticket-block_info">No tickets</p>')
      })
    })
  </script>
  {% endblock %}
</body>



